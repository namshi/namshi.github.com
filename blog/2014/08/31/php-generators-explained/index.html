<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <title>PHP Generators explained &mdash; Namshi Engineering</title>
    <!-- <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css"> -->

    <link rel="stylesheet" type="text/css" href="/stylesheets/prism.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/namshi-logo.png"/>
    <link href="/atom.xml" rel="alternate" type="application/rss+xml" title="Namshi Engineering" />
    <meta name="title" content="PHP Generators explained ">
    <link rel="canonical" href="http://namshi.github.io/blog/2014/08/31/php-generators-explained/">
    
    
    <meta property="og:title" content="PHP Generators explained "/>
    <meta property="og:url" content="http://namshi.github.io/blog/2014/08/31/php-generators-explained/"/>
    
    
    <meta property="og:site_name" content="Namshi Engineering">
</head>
<body>

<section class="site-nav">
    <header>
        <a class="brand" href="/">
          <img src="/images/namshi-logo.png" alt="Inc">
        </a>
        <a href="#" class="burger-icon"></a>
        <nav id="navigation">
            <a href="/" class="home">Blog</a>
            <a href="/team">Team</a>
            <a href="https://github.com/namshi">Github</a>
            <a href="/archives">Archives</a>
            <a class="join-us-link" href="/join-us/">HACK WITH US</a>
        </nav>
        <nav class="tagline">
            <!--<span>HACK WITH US</span>-->
            <a href="/join-us/" class="btn btn-outline">HACK WITH US</a>
        </nav>
    </header>
</section>


<article>

    <div class="container">
        <header>
            <div class="meta">
                <time pubdate datetime="2014-31-August" title="August 31, 2014">August 31, 2014</time>
            </div>
            <h1 class="title">PHP Generators explained</h1>
            
        </header>
        <footer>
            <address>
               
                <p>Written by <strong><a rel="author" href="/team/#Hossam Faris" title="Hossam Faris">
                
                    Hossam Faris
                
                </a></strong><br>
                <span class="muted"></span>
                </p>
            </address>

        </footer>
        <section>
            <p><code>Generators</code> are one of the new cool stuff on <code>PHP 5.5</code>, but it&rsquo;s not a new feature in software programming languages, for example it&rsquo;s on <code>Python</code> since version 2.2 on 2001 and now in the draft <code>ECMAScript</code> 6  (Javascript) specification.</p>

<p>They are a simple and powerful tool for creating <code>iterators</code>. They are like regular functions but using the <code>yield</code> statement whenever they want to return data. A <code>generator</code> looks like a function but behaves like an iterator, it&rsquo;s useful for <code>lazy evaluation</code> &ldquo;which delays the evaluation of an expression until its value is needed&rdquo;.</p>

<!-- more -->


<p>Here are some examples in different languages:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-javascript'>// infinite id generator in JavaScript

function* generateId(){
    var index = 0;

    while(true) {
        yield index++;
    }
}

var gen = idMaker();
console.log(gen.next().value); // 0
console.log(gen.next().value); // 1
console.log(gen.next().value); // 2</code></pre></figure>




<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-python'>//Python

def generateId(n):
    num = 0
    while num &lt; n:
        yield num ++

count_gen_ids = count(generateId(1000))</code></pre></figure>




<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>//PHP
&lt;?php

function generateId() {
    $currentId = 1;

    while(true) {
        yield ++ $currentId;
    }
}

for($index = 0; $index &lt; 1000) {
    echo $index;
}
</code></pre></figure>


<p>In this examples you would notice that we are using the keyword <code>yield</code> instead of <code>return</code>. <code>return</code> will pass value to the function caller then the function will finish the execution, <code>yield</code> will pass a value then pause the execution of the function &ldquo;which now became a generator&rdquo; till the function caller ask for the next value. Then <code>yield</code> again and again will return values to the function caller.</p>

<p>Using generators is useful in cases where you want iterations on demand, and you will end up with less resources consumption and also still the chance to send some data back to the generator function on any given iteration.</p>

<p>When you have situations that you are fetching large sets of data, you can use generators to <code>lazy load</code> (&ldquo;lazy load is to post pone fetching data till the point that you actually need it) your data sets or doing a lot of computation with big amounts of data.</p>

<p>Imagine that you have the code to execute a query on the database, instead of fetching and returning the whole data at the same time, you can simply return a generator function containing the query cursor that yields one data row at a time.</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

function getUsers()
{
    $dbh = new PDO(&apos;mysql:host=xyz;port=xyz;dbname=xyz&apos;, &apos;[...]&apos;);
    $stmt = $dbh-&gt;prepare(&quot;SELECT * FROM users&quot;);
    $stmt-&gt;execute();

    try {
        while ($rs = $stmt-&gt;fetch(PDO::FETCH_OBJ)) {
           yield $rs;
        }
    } finally {
        $stmt-&gt;closeCursor();
    }
 }


$users = getUsers();

foreach ($users as $user){
    print_r($user);
}</code></pre></figure>


<p>Speaking of Javascript, one great usage example for generators is the <a href="http://taskjs.org/">task</a> library, a combination of <a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/"><code>promises</code></a>, and <code>generators</code> to write asynchronous callbacks as beautiful as synchronous code.</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-javascript'>function go() {
    var { spawn, join } = task;

    var out = document.getElementById(&quot;out&quot;);

    spawn(function() {
        out.innerHTML = &quot;reading...\n&quot;;
        try {
            var [ f1, f2 ] = yield join(read(&quot;sleep.html&quot;), read(&quot;read.html&quot;));
            out.innerHTML += &quot;sleep.html: &quot; + (f1.responseText.length) + &quot;\n&quot;;
            out.innerHTML += &quot;read.html: &quot; + (f2.responseText.length) + &quot;\n&quot;;
        } catch (e) {
            e.stack.split(/\n/).forEach(function(line) { console.log(line) });
            console.log(&quot;&quot;);
            out.innerHTML = &quot;error: &quot; + e;
        }
    });
}</code></pre></figure>


<p>Finally you need to consider some stuff before start using <code>Generator</code>, beware that once it get consumed you cannot reset it, you will need to recall it again.</p>

<p>Also keep resources like db connection and file stream busy on the <code>Generator</code> function could be a problem if you are heavily use this resources and you need to release it as soon as possible.</p>

            
            <footer>
                <span class="categories">Posted in <a class='category' href='/blog/categories/php/'>PHP,</a>, <a class='category' href='/blog/categories/generators/'>generators</a></span>
            </footer>
            
            <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox"></div>
        </section>

        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'namshitechblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2019 <a href="https://tech.namshi.io">Namshi</a> &middot;
        
        <nav>
            <a href="/">Blog</a> &middot;
            <a href="/team">Team</a> &middot; 
            <a href="https://github.com/namshi">Github</a> &middot; 
            <a href="/join-us/">Careers</a> 
        </nav>

        <nav class="social">
            
            <a href="https://twitter.com/technamshi" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="http://facebook.com/NamshiFans" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
            
            <a href="/atom.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="/javascripts/main.js"></script>
<script type="text/javascript" src="/javascripts/prism.js"></script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57bdfe0617e09a06"></script>

  <!--google analytics tracking code here-->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27338864-10', 'auto');
    ga('send', 'pageview');
  </script>




</body>
</html>
