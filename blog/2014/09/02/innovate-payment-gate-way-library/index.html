<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <title>Innovate Payment Gateway Library &mdash; Namshi Engineering</title>
    <!-- <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css"> -->

    <link rel="stylesheet" type="text/css" href="/stylesheets/prism.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/namshi-logo.png"/>
    <link href="/atom.xml" rel="alternate" type="application/rss+xml" title="Namshi Engineering" />
    <meta name="title" content="Innovate Payment Gateway Library ">
    <link rel="canonical" href="http://namshi.github.io/blog/2014/09/02/innovate-payment-gate-way-library/">
    
    
    <meta property="og:title" content="Innovate Payment Gateway Library "/>
    <meta property="og:url" content="http://namshi.github.io/blog/2014/09/02/innovate-payment-gate-way-library/"/>
    
    
    <meta property="og:site_name" content="Namshi Engineering">
</head>
<body>

<section class="site-nav">
    <header>
        <a class="brand" href="/">
          <img src="/images/namshi-logo.png" alt="Inc">
        </a>
        <a href="#" class="burger-icon"></a>
        <nav id="navigation">
            <a href="/" class="home">Blog</a>
            <a href="/team">Team</a>
            <a href="https://github.com/namshi">Github</a>
            <a href="/archives">Archives</a>
            <a class="join-us-link" href="/join-us/">HACK WITH US</a>
        </nav>
        <nav class="tagline">
            <!--<span>HACK WITH US</span>-->
            <a href="/join-us/" class="btn btn-outline">HACK WITH US</a>
        </nav>
    </header>
</section>


<article>

    <div class="container">
        <header>
            <div class="meta">
                <time pubdate datetime="2014-02-September" title="September 02, 2014">September 02, 2014</time>
            </div>
            <h1 class="title">Innovate Payment Gateway Library</h1>
            
        </header>
        <footer>
            <address>
               
                <div class="author-pic">
                  <img src="/images/ayham.jpg">
                </div>
               
                <p>Written by <strong><a rel="author" href="/team/#Ayham Alzoubi" title="Ayham Alzoubi">
                
                    Ayham Alzoubi
                
                </a></strong><br>
                <span class="muted">Software Engineering Lead</span>
                </p>
            </address>

        </footer>
        <section>
            <p>In the tech <a href="https://namshi.com">Namshi</a> team, as you probably know, we fully support the open source movement,
that&rsquo;s why we try to release open source software as soon as we can, in the full &ldquo;give back to the community&rdquo; mindset.
You can check all our project on <a href="http://github.com/namshi">github</a></p>

<p>Lots of e-commerce companies and service providers have online payments for their
customers. So do we.</p>

<p>Our weapon of choice, apart from PayPal, to carry out payments is: <a href="http://www.innovatepayments.com">Innovate.</a>
That&rsquo;s why we developed and released the <a href="https://github.com/namshi/innovate">Innovate library</a>, written in PHP.</p>

<p><a href="http://www.innovatepayments.com">Innovate</a> payment gateway accepts all types of credit card payments.</p>

<!-- more -->


<h2>Installation</h2>

<p>You can easily integrate the Innovate library in your project via <a href="https://getcomposer.org">composer</a>:</p>

<figure class='code'><pre><code class='language-bash'>composer install namshi/innovate</code></pre></figure>


<p><img class="center" src="/images/posts/cards.png" title="payment cards" ></p>

<h2>Usage</h2>

<p>Using this library is easy, here is what you need:</p>

<ul>
<li>initialize the Innovate client</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

use Namshi\Innovate\Payment\Transaction;
use Namshi\Innovate\Payment\BillingInformation;
use Namshi\Innovate\Payment\Browser;
use Namshi\Innovate\Payment\Billing\Customer;
use Namshi\Innovate\Payment\Billing\Address;
use Namshi\Innovate\Payment\Card;
use Namshi\Innovate\Client;

$client      = new Client($storeId, $authenticationKey); // retrieve them from your Innovate account
$transaction = new Transaction(&apos;sale&apos;, &apos;ecom&apos;, true, &apos;ORDER_NUMBER&apos;, &apos;DESCRIPTION&apos;, &apos;USD&apos;, 40, &apos;AN OPTIONAL REFERENCE TO YOUR TRANSACTION&apos;);
$card        = new Card(&apos;1234123412341234&apos;, &apos;111&apos;, new \DateTime($cardExpiryDate));
$customer    = new Customer(&apos;Mr&apos;, &apos;John&apos;, &apos;Doe&apos;);
$address     = new Address(&apos;My address info 1&apos;, &apos;My address info 2&apos;, &apos;My address info 3&apos;, &apos;San Francisco&apos;, &apos;California&apos;, &apos;US&apos;, &apos;00000&apos;);
$billing     = new BillingInformation($customer, $address, &quot;customers&apos;s-email@gmail.com&quot;, $customerIpAddress);
$browser     = new Browser($customUserAgent, $requestAcceptHeader);</code></pre></figure>


<p>We used OOP to cover all the data we need to send to Innovate:</p>

<p><code>$client</code> is a model that contains the Innovate account info.</p>

<p><code>$transaction</code> represents a detailed transaction where we pass as many arguments as Innovate needs.</p>

<p><code>$card</code> represents the required card details to perform the payment.</p>

<p><code>$customer</code> represents the customer details.</p>

<p><code>$address</code> represents the customer address details.</p>

<p><code>$billing</code> represents the customer billing address and contact details.</p>

<p><code>$browser</code> represents detailed browser info, including the User-Agent.</p>

<p><code>$customUserAgent</code> is the browser user agent header.</p>

<p><code>$requestAcceptHeader</code> is the browser accept header.</p>

<h2>How It Works</h2>

<p>To perform the payment you need to create a request to <a href="http://www.innovatepayments.com">Innovate</a> and pass the previous created objects:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>
&lt;?php

$response = $client-&gt;performPayment($transaction, $card, $billing, $browser);</code></pre></figure>


<p>You will then get one of the following responses:</p>

<ul>
<li><h2>Normal transaction</h2>

<p>A normal transaction follows a very simple flow: It just requires authentication through Innovate, and the library then performs the payment.</p></li>
<li><h2>3D secure transactions</h2>

<p>A <a href="http://en.wikipedia.org/wiki/3-D_Secure">3-D_Secure</a> transaction requires two requests to Innovate and one request for 3D Secure in order
to add an additional security layer while performing the payment.
The first request is already sent to Innovate and if it is 3D Secure transaction you will need to redirect the user to the concerned party
(primarily, the bank) to confirm the payment.</p></li>
</ul>


<p>After that the process continues by sending another request to Innovate containing the extra validation values.</p>

<p>You can easily distinguish between the two possible types of payments, 3D Secure and Normal, by looking at the type of Innovate response received:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

use use Namshi\Innovate\Http\Response\Redirect;

$response = $client-&gt;performPayment($transaction, $card, $billing, $browser);

if ($response instanceOf Redirect) {
    // 3D secure transactions
} else {
    // Normal transactions
}</code></pre></figure>


<p>In case of normal Transactions, the library will perform the payment directly.
In case of 3D Secure transactions you need to send another request
with more details (related to the third security party) as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

use Namshi\Innovate\Http\Response\Redirect;

if ($response instanceof Redirect) {
    // build a form
}</code></pre></figure>


<p>The response object contains the values (&lsquo;targetUrl&rsquo;, &lsquo;session&rsquo;, &lsquo;paReq&rsquo;) which are needed to build the form:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

$targetUrl  = $response-&gt;getTargetUrl();
$session    = $response-&gt;getSession();
$pareq      = $response-&gt;getPareq();</code></pre></figure>


<p>Then, the receiving the previous values will be used to build a form as hidden values.
The form will be sent to the <code>$targetUrl</code> which is the 3D-secure service page as the following:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-xml'>
&lt;form name=&quot;acsform&quot; action=&quot;[targetUrl from the response]&quot; method=&quot;post&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;PaReq&quot; value=&quot;[The pareq data from response]&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;MD&quot; value=&quot;[Any value can be stored here which will be sent back unchanged in the the 3d secure response e.g to preserve the session id which we can send back to complete the transaction]&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;TermUrl&quot; value=&quot;[return URL on your site]&quot;&gt;
    &lt;noscript&gt;
        &lt;input type=&quot;Submit&quot;&gt;
    &lt;/noscript&gt;
&lt;/form&gt;</code></pre></figure>


<p><code>termUrl</code>: the URL that we need to direct the user to, after the user submits the form.</p>

<p>See an example of an ACS (Access Control Server) Form</p>

<p>We need to submit the form with Javascript:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-javascript'>
function autosub() {
    document.forms[&apos;acsform&apos;].submit();
}

document.onload=autosub;</code></pre></figure>


<p>After the form is submitted, the user is redirected to a 3D Secure page which asks for extra credentials.
Once the user submits the 3D Secure form, he/she gets redirected to the &lsquo;termUrl&rsquo; page with two hidden values
(&lsquo;PaRes&rsquo;, &lsquo;MD&rsquo;) which are used to create the final request to Innovate:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

$extraData = array(
    &apos;PaRes&apos;     =&gt; &apos;Authentication response&apos;, // we get this value from hidden fields after redirection to termUrl
    &apos;session&apos;   =&gt; &apos;MD&apos;, // we get this value from hidden fields after redirection to termUrl
);

$finalResponse = $client-&gt;send($client-&gt;createRemoteRequest(&apos;POST&apos;, Client::INNOVATE_URL, null, null, $extraData));</code></pre></figure>


<p>Then we get the final response which can be checked for payment status &ndash; success or denied:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>&lt;?php

if (200 === $finalResponse-&gt;getStatusCode()) {
    // payment done
} else {
    // authentication failed
}</code></pre></figure>


<h2>Tests</h2>

<p>We added two types of tests; to run them you need to install the dev dependencies using composer and then run
the test using <a href="http://phpunit.de">PHPUnit</a></p>

<ul>
<li><h3>Functional Test:</h3>

<p>These test the library functionality without sending any real request to Innovate, just hit this on your terminal:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>phpunit</code></pre></figure>


<ul>
<li><h3>integration Test</h3>

<p>There are a couple of integration tests that verify that the library works flawlessly by creating
real requests to the Innovate payment gateway. Just use valid test credentials, then create a file
called .innovate.config in the project directory with four parameters:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>
&lt;?php

$configs = array(
    &apos;storeId&apos;           =&gt; &apos;xxxxx&apos;, //store Id in Innovate
    &apos;authenticationKey&apos; =&gt; &apos;xxxxxxxxxxx&apos;, //authentication key
);

// Card info
$cardInfo = array(
    &apos;number&apos;    =&gt; &apos;xxxxxxxxxxxx&apos;,
    &apos;cvv&apos;       =&gt; &apos;XXX&apos;,
);

// The card which need redirection for 3d secured
$redirectUrlCardInfo = array(
    &apos;number&apos;    =&gt; &apos;xxxxxxxxxxxx&apos;,
    &apos;cvv&apos;       =&gt; &apos;XXX&apos;,
);

// your ip, it should be in Innovate white list
$ip = &apos;xxx.xxx.xxx.xxx&apos;;</code></pre></figure>


<p>After the setup, just run:</p>

<figure class='code'><figcaption><span></span></figcaption><pre><code class='language-php'>phpunit tests/Namshi/Innovate/Test/Integration/ServiceTest.php</code></pre></figure>


<p>We hope that you enjoy using Namshi&rsquo;s open source library. We&rsquo;ve been using this library for almost a year and
it&rsquo;s working fine with no issues on our side. As always, any feedback and pull requests are welcome :)</p>

            
            <footer>
                <span class="categories">Posted in <a class='category' href='/blog/categories/api/'>API</a>, <a class='category' href='/blog/categories/gateway/'>gateway</a>, <a class='category' href='/blog/categories/payment/'>payment</a>, <a class='category' href='/blog/categories/php/'>php</a></span>
            </footer>
            
            <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox"></div>
        </section>

        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'namshitechblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2019 <a href="https://tech.namshi.io">Namshi</a> &middot;
        
        <nav>
            <a href="/">Blog</a> &middot;
            <a href="/team">Team</a> &middot; 
            <a href="https://github.com/namshi">Github</a> &middot; 
            <a href="/join-us/">Careers</a> 
        </nav>

        <nav class="social">
            
            <a href="https://twitter.com/technamshi" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="http://facebook.com/NamshiFans" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
            
            <a href="/atom.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="/javascripts/main.js"></script>
<script type="text/javascript" src="/javascripts/prism.js"></script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57bdfe0617e09a06"></script>

  <!--google analytics tracking code here-->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27338864-10', 'auto');
    ga('send', 'pageview');
  </script>




</body>
</html>
